<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Progreso del Usuario</title>

  <!-- Librer√≠a Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f1f5f9;
      color: #1e293b;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
      padding: 20px;
      margin: 0;
    }

    h1 {
      color: #1e3a8a;
    }

    .dashboard {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
      width: 260px;
    }

    canvas {
      max-width: 200px;
      margin: 0 auto;
    }

    .footer {
      margin-top: 40px;
      color: #64748b;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>Panel de Progreso del Usuario</h1>

  <div class="dashboard">
    <div class="card">
      <h3>üçé Frutas comidas (semana)</h3>
      <canvas id="chartFrutas"></canvas>
    </div>

    <div class="card">
      <h3>üíß Agua bebida (litros hoy)</h3>
      <canvas id="chartAgua"></canvas>
    </div>

    <div class="card">
      <h3>ü•ó D√≠as cumpliendo la dieta</h3>
      <canvas id="chartDieta"></canvas>
    </div>
  </div>

  <div class="footer">Datos simulados ‚Äî ejemplo funcional sin errores</div>

  <script>
    // ======== DATOS SIMULADOS ==========
    // En una versi√≥n con MongoDB, estos valores vendr√≠an de la base de datos
    const datosUsuario = {
      frutas: { progreso: 5, total: 7 },
      agua: { progreso: 2.5, total: 3 },  // litros de 3 recomendados
      dieta: { progreso: 6, total: 7 }     // d√≠as cumplidos de 7
    };

    // ======== FUNCI√ìN GENERAL ==========
    function crearGrafico(idCanvas, progreso, total, color) {
      const ctx = document.getElementById(idCanvas).getContext('2d');

      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Completado', 'Restante'],
          datasets: [{
            data: [progreso, total - progreso],
            backgroundColor: [color, '#e2e8f0'],
            borderWidth: 0
          }]
        },
        options: {
          cutout: '70%',
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: (context) => `${context.label}: ${context.parsed.toFixed(1)}`
              }
            }
          }
        },
        plugins: [{
          id: 'porcentajeCentro',
          beforeDraw: (chart) => {
            const { width } = chart;
            const { ctx } = chart;
            ctx.restore();
            const fontSize = 18;
            ctx.font = `bold ${fontSize}px Poppins`;
            ctx.textBaseline = 'middle';
            const porcentaje = Math.round((progreso / total) * 100);
            const text = `${porcentaje}%`;
            const textX = Math.round((width - ctx.measureText(text).width) / 2);
            const textY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2;
            ctx.fillStyle = '#1e3a8a';
            ctx.fillText(text, textX, textY);
            ctx.save();
          }
        }]
      });
    }

    // ======== CREAR GR√ÅFICOS ==========
    crearGrafico('chartFrutas', datosUsuario.frutas.progreso, datosUsuario.frutas.total, '#22c55e');
    crearGrafico('chartAgua', datosUsuario.agua.progreso, datosUsuario.agua.total, '#3b82f6');
    crearGrafico('chartDieta', datosUsuario.dieta.progreso, datosUsuario.dieta.total, '#f59e0b');
  </script>
</body>
</html>
