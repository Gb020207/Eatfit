
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Progreso del Usuario</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f1f5f9;
      color: #1e293b;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
      padding: 20px;
      margin: 0;
    }

    .dashboard {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
      width: 260px;
    }

    canvas {
      max-width: 200px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>Panel de Progreso del Usuario</h1>
  <div class="dashboard" id="dashboard">
    <div class="card">
      <h3>üçé Frutas comidas (semana)</h3>
      <canvas id="chartFrutas"></canvas>
    </div>
    <div class="card">
      <h3>üíß Agua bebida (litros hoy)</h3>
      <canvas id="chartAgua"></canvas>
    </div>
    <div class="card">
      <h3>ü•ó D√≠as cumpliendo la dieta</h3>
      <canvas id="chartDieta"></canvas>
    </div>
  </div>
  <div style="background:white;padding:20px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);">
  <h3>Actualizar Progreso</h3>
  <form id="formProgreso">
    <label>üçé Frutas:</label>
    <input type="number" id="inputFrutas" step="1" min="0" max="7" /><br><br>

    <label>üíß Agua (litros):</label>
    <input type="number" id="inputAgua" step="0.1" min="0" max="3" /><br><br>

    <label>ü•ó D√≠as dieta:</label>
    <input type="number" id="inputDieta" step="1" min="0" max="7" /><br><br>

    <button type="submit" style="background:#1e3a8a;color:white;border:none;padding:10px 15px;border-radius:8px;cursor:pointer;">Actualizar</button>
  </form>
</div>


  <script>
    // Cambia el ID seg√∫n tu usuario real en la BD
    // const user = User.find()
    const userId = 1;
    const API_URL = `http://localhost:3000/api/progreso/${userId}`;

    async function obtenerDatos() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error('Error al obtener datos del servidor');
        const data = await res.json();
        mostrarGraficos(data);
      } catch (err) {
        console.error('‚ùå Error:', err);
      }
    }

    function crearGrafico(idCanvas, progreso, total, color) {
      const ctx = document.getElementById(idCanvas).getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Completado', 'Restante'],
          datasets: [{
            data: [progreso, total - progreso],
            backgroundColor: [color, '#e2e8f0'],
            borderWidth: 0
          }]
        },
        options: {
          cutout: '70%',
          plugins: {
            legend: { display: false },
            tooltip: { enabled: false }
          }
        },
        plugins: [{
          id: 'textoCentro',
          beforeDraw: (chart) => {
            const { width } = chart;
            const { ctx } = chart;
            ctx.restore();
            const fontSize = 18;
            ctx.font = `bold ${fontSize}px Poppins`;
            ctx.textBaseline = 'middle';
            const porcentaje = Math.round((progreso / total) * 100);
            const text = `${porcentaje}%`;
            const textX = Math.round((width - ctx.measureText(text).width) / 2);
            const textY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2;
            ctx.fillStyle = '#1e3a8a';
            ctx.fillText(text, textX, textY);
            ctx.save();
          }
        }]
      });
    }

    function mostrarGraficos(datos) {
      crearGrafico('chartFrutas', datos.frutas, datos.frutasMeta, '#22c55e');
      crearGrafico('chartAgua', datos.agua, datos.aguaMeta, '#3b82f6');
      crearGrafico('chartDieta', datos.dietaCumplidos, datos.dietaMeta, '#f59e0b');
    }

    obtenerDatos();
    // === Formulario para actualizar progreso ===
const form = document.getElementById('formProgreso');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const frutas = parseFloat(document.getElementById('inputFrutas').value);
  const agua = parseFloat(document.getElementById('inputAgua').value);
  const dietaCumplidos = parseFloat(document.getElementById('inputDieta').value);

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ frutas, agua, dietaCumplidos })
    });
    const data = await res.json();
    alert(data.message || 'Actualizado correctamente');
    obtenerDatos(); // Refrescar los gr√°ficos
  } catch (err) {
    console.error('‚ùå Error:', err);
  }
});

  </script>
</body>
</html>
